# Sistem Check-up Notları

Tarih: 2025-02 (Phase 6.2 + scenario_test + base_config sonrası). Tüm testler ve modül kontrolleri yapıldı.

---

## 1. Çalıştırılan Testler

- **run_all_tests.py:** 16/16 aşama geçti.
  - Engine + Replay, Senaryo, Uncertainty, Soft Override, Soft Clamp, Temporal Drift, Trace Collector, Learning, Scenario Generator, Adversarial (4), Monte Carlo, Chaos, Config profile.
- **Ek doğrulamalar:**
  - scenario_test + safe state → L2 %23 (L2 < 100%).
  - Optimization base_config=scenario_test → fail_safe_rate 0.25–0.30 (anlamlı).
  - Dashboard run_demo_steps(20, balanced, scenario_test) → 14 non-L2 kayıt.
  - config_profiles list_profiles() → scenario_test mevcut; J_CRITICAL<=0.5, H_CRITICAL>=0.9.
- **CLI:** step --profile balanced, optimize --profile safe çalıştı. optimize için --config-base scenario_test eklendi (L0/L1/L2 görünür).

---

## 2. Modül Tutarlılığı

| Modül | Kontrol | Sonuç |
|-------|---------|--------|
| core/trace_collector | build_decision_trace: engine "escalation" → "level", "raw_action"/"action", "soft_safe_applied", "temporal_drift", "self_regulation" | OK, engine çıktısı ile uyumlu |
| core/fail_safe | worst_J, worst_H ile tek çağrı; J_CRITICAL, H_CRITICAL config'ten | OK |
| learning/offline_loop | base_config merge: effective = {**base_config, **config} | OK |
| learning/run_optimization_loop | base_config run_offline_step'e iletilir; HISTORY_PARAM_KEYS history kaydında | OK |
| learning/policy_optimizer | PARAM_BOUNDS sadece J_MIN, H_MAX, SOFT_CLAMP_*, DELTA_CUS, CUS_MEAN; J_CRITICAL/H_CRITICAL yok (base_config ile sabit) | OK |
| simulation/scenario_generator | PROFILE_BOUNDS safe/balanced/critical/chaos; STATE_KEYS ile uyumlu | OK |
| config_profiles | scenario_test J_CRITICAL=0.45, H_CRITICAL=0.98; list_profiles'a eklendi | OK |
| visualization/dashboard | Demo: config_profile + run_demo_steps; Optim: opt_config_base → initial + base_config, run_optimization_loop(..., base_config=base_config) | OK |

---

## 3. Şüpheli / Dikkat Edilecek Noktalar

### 3.1 Varsayılan config ile her zaman L2

- **Sebep:** Grid'te severity=1 var → worst_J=0.5; varsayılan J_CRITICAL=0.7 → her zaman fail_safe.
- **Not:** Bu tasarım gereği (güvenlik öncelikli). L0/L1 görmek için scenario_test veya gevşek profil kullanılmalı. **Üretimde varsayılan config kullanılmalı.**

### 3.2 CLI optimize — config-base

- **Eski:** CLI `optimize` base_config kullanmıyordu → hep %100 fail_safe.
- **Düzeltme:** `--config-base scenario_test` eklendi. Komut: `python tools/run_offline_learning.py optimize --profile safe --config-base scenario_test`

### 3.3 Chaos invariant ve scenario_test

- Chaos testi varsayılan/config_profiles config'leri ile çalışır. scenario_test (J_CRITICAL=0.45, H_CRITICAL=0.98) chaos runner'da kullanılmıyor; chaos invariant'ları sıkı config için tanımlı. scenario_test ile chaos koşturulursa invariant eşikleri farklı olabilir — şu an chaos testi mevcut profillerle geçiyor, ayrı senaryo_test chaos testi yok. **İsteğe:** scenario_test için ayrı invariant seti veya dokümantasyon.

### 3.4 learning/__init__.py export

- `run_optimization_loop` __all__'da yok; dashboard ve tools doğrudan `learning.run_optimization_loop` import ediyor. **Sorun yok**, sadece API tercihi.

### 3.5 Monte Carlo (run_all_tests) hep L2

- Monte Carlo 500 state ile varsayılan config kullanır → %100 L2 beklenir. Test suite davranış/istatistik doğrulaması yapıyor, L0/L1 görmek için değil. **Beklenen.**

---

## 4. Özet

- **Sistem düzgün çalışıyor:** 16/16 test, scenario_test L0/L1/L2, optimization base_config, dashboard demo/optim, CLI step/optimize (config-base eklendi).
- **Modüller tutarlı:** trace_collector ↔ engine, learning offline_loop ↔ base_config, scenario_generator profiller, config_profiles scenario_test.
- **Dikkat:** Varsayılan config bilinçli sıkı; L0/L1 için scenario_test veya gevşek profil. CLI optimize için anlamlı metrik için `--config-base scenario_test` kullan.

Bu notlar, genel check-up ve şüpheli noktaların özetidir.

---

## Güncelleme: Phase 6.3, 6.4, 7 (yol haritası sonrası)

- **Phase 6.3:** Curriculum (easy/medium/hard), non_fail_reward, clamp_test profili uygulandı.
- **Phase 6.4:** safety_gate eklendi; chaos/scenario_test dokümantasyonu docs/20_CHAOS_AND_CONFIG_PROFILES.txt.
- **Phase 7:** Engine + trace J/H; Decision Boundary heatmap; Parametre duyarlılığı paneli.
- Detay: docs/21_PHASE_63_64_7_ROADMAP.txt.
